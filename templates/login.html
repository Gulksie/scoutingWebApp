{%extends "default.html"%}

{%block head%}
{{super()}}
<script src="https://apis.google.com/js/platform.js" async defer></script>
<script>
    function onSignIn(user) {
        var profile = user.getBasicProfile()

        var toSend = {
            name: profile.getName(),
            email: profile.getEmail(),
            ID: user.getAuthResponse().id_token
        }

        var xrequest = new XMLHttpRequest()
        xrequest.open("POST", "{{ url_for('loginPage') }}")
        xrequest.setRequestHeader("Content-Type", "application/json")
        xrequest.setRequestHeader("Login-Type", "google-signin")
        xrequest.onload = function () {
            window.open(xrequest.responseURL, "_self")
        }
        xrequest.send(JSON.stringify(toSend))
    }

    function signOut() {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
            console.log('User signed out.');
        });

        var xrequest = new XMLHttpRequest()
        xrequest.open("GET", "{{ url_for('loginPage') }}")
        xrequest.setRequestHeader("Login-Type", "LOGOUT")
        xrequest.onload = function () {
            window.open(xrequest.responseURL, "_self")
        }
        xrequest.send()
    }
</script>

<meta name="google-signin-client_id" content="{{googleID}}.apps.googleusercontent.com">

{%endblock%}

{%block title%}Login{%endblock%}
{%block content%}
<form method="POST">
    <label><b>Username</b></label>
    <input type="text" placeholder="Username" name="usr" required>

    <label><b>Password</b></label>
    <input type="password" name="psw" required>

    <button type="submit">Login</button>
    {%if retry%}
    <p id="invalidPass">Invalid username/password. Please try again.</p>
    {%endif%}
</form>
<div class="g-signin2" data-onsuccess="onSignIn"></div>
<br>
<a href="#" onclick="signOut">Sign out</a>
{%endblock%}